---
layout: post
title: 'Blue Teaming pt. 1: Static Malware Analysis 101'
date: '2021-03-08T16:37:39+00:00'
tags:
- hacking
- hacking tutorials
- hacking guide
- linux
- linux terminal
- linux tutorial
- Kali
- Kali Linux
- malware
- malware analysis
- blue team
tumblr_url: https://undedinside.tumblr.com/post/645125331153518592/blue-teaming-pt-1-static-malware-analysis-101
---
<h2>What is Static Malware Analysis?</h2><p>Static malware analysis is when you attempt to learn about
a malicious program without letting it run. This could be to gain some insight
as to how it runs to be used in dynamic analysis later.</p><h2>Handling Malware Safely:</h2><p>When analysing malware, the most important thing (in my
opinion at least) is to keep your network safe. If you detect malware on your
network and manage to isolate it, the last thing you want is to re-release it.</p><p>I would recommend having a separate machine used just for
malware analysis to avoid data theft on your main device. You could use a
physical computer for this, but that could be expensive. A dedicated virtual
machine is perfectly sufficient for this (If you don’t know how to set up a VM,
you can read my guides on using VirtualBox and VMware).</p><p>When dealing with malware it is a good idea to isolate the
machine. This stops the malware from spreading to other devices. This could be
done by either disconnecting the machine from the network (via disabling the
network adapter) or, if the machine requires some form of network access, putting
it on a virtual LAN segment.</p><p>To conclude: Have a dedicated device (preferably a VM) and
disable the network adapter to isolate the machine when you start handling the
malware. Once you have safely set up your machine you can download a sample
from my GitHub, which can be unzipped with the password “infected”.</p><h2>Detecting a Malware:</h2><p>We know that what we just downloaded is malicious, but
let’s pretend we don’t. An antivirus program is a good indicator of if a file
is malicious or not, but they have their limitations: namely that they can’t
detect malware with 100% efficiently. To get a more accurate idea of if a file
is malware or not we will need multiple antivirus programs. Enter VirusTotal.
This website runs any file you upload to it through multiple different
antivirus and reports if they find the software suspicious.</p><p>When I run the sample through VirusTotal, I get output like
so:</p><figure class="tmblr-full" data-orig-height="860" data-orig-width="1858"><img src="https://64.media.tumblr.com/fa097d79ca9131247e52c62b613ac129/00e3ca3466aaafc3-e7/s540x810/5ce8554998d921797d93f488c0345d58a3ca6d8d.png" data-orig-height="860" data-orig-width="1858"/></figure><p>Not every AV detected the sample, however over half of them
did. This is enough to decide fairly conclusively that the file is malicious.</p><p>VirusTotal also has a feature where you can search with a
hash of a file. You can use either MD5 (which can be found with the command ‘md5sum
[filename]’) or SHA256 (‘sha256sum [filename]’)</p><figure class="tmblr-full" data-orig-height="496" data-orig-width="666"><img src="https://64.media.tumblr.com/bd43b06597d3db79a75c581d23069367/00e3ca3466aaafc3-75/s540x810/c64b1173f1ebdc1ab6826fa580de41549dea67f7.png" data-orig-height="496" data-orig-width="666"/></figure><p>After getting the hash of the file, you can search for it
in VirusTotal. Since the hash and the file you uploaded mean the same thing,
the results will be identical.</p><figure class="tmblr-full" data-orig-height="860" data-orig-width="1858"><img src="https://64.media.tumblr.com/74650338a1ef98f4b4ddae8459203aac/00e3ca3466aaafc3-e4/s540x810/2d9cbb530ab93f70711e5fedcc11f8439301ee7d.png" data-orig-height="860" data-orig-width="1858"/></figure><p>When you search on VirusTotal, the website automatically
converts the search to a SHA256 hash. This is why you can upload a file or
different types of hashes.</p><h2>Static Analysis</h2><p>VirusTotal also gives you more information than whether a file
is malicious. In the ‘Behaviour’ tab you can see information on the malware
such as what domains/IP addresses it tried to reach, as well as any files it modifies.
As a Blue-Teamer you can block the domains that it talks to from being accessed
on your network, and also look for files that it leaves behind to tell if the
malware has run.</p><figure class="tmblr-full" data-orig-height="860" data-orig-width="1858"><img src="https://64.media.tumblr.com/98d49c4104b313ce9df02bc162dc88ba/00e3ca3466aaafc3-f0/s540x810/caba99fc46936646bdab19e5dcfd5d4764ba7499.png" data-orig-height="860" data-orig-width="1858"/></figure><p>We can see that the trickbot sample downloads a file from
soberlifeco[dot]com. We can also see that it makes a TCP request to an IP
address (This corresponds to the domain found, but it may be useful to know
both). Needless to say, you probably shouldn’t go to this domain unless you
know what you are doing and can do so safely.</p><p>Up to recently we’ve been relying on another service for
our analysis, but what if we want to do some ourselves? Maybe we’ve found a
file which isn’t on VirusTotal, or maybe we want to verify the findings for ourselves.
A simple tool I found for reverse engineering is the ‘strings’ command. This
command searches through the file you pass to it and outputs what it thinks
might be human-readable text. When we run ‘strings’ on trickbot.xls, we get
output like this:</p><figure class="tmblr-full" data-orig-height="494" data-orig-width="664"><img src="https://64.media.tumblr.com/5d2fe5e97b6baee5531f980ab8b4d2d0/00e3ca3466aaafc3-f1/s540x810/b4599248076004e3be463ad3b419e5dc31e72709.png" data-orig-height="494" data-orig-width="664"/></figure><p>It is important to remember that what is readable for a
human is not for a computer and vice versa, so most output from a ‘string’
command isn’t useful however if we look through, we can see the URL we found on
VirusTotal:</p><figure class="tmblr-full" data-orig-height="494" data-orig-width="664"><img src="https://64.media.tumblr.com/ca0d021ded1d9eff16912bc07238837b/00e3ca3466aaafc3-72/s540x810/8be3fd0d5d882ee793c0c988e67ec640d2c969f1.png" data-orig-height="494" data-orig-width="664"/></figure><p>It’s been broken up by another bit of text, but on one line
you can see “<a href="#http://">http://</a>” indicating the protocol to use, and
then two lines later is the rest of the domain (“soberlifeco[dot]com”) and the
path to the file that our sample downloads.</p><h2>Conclusion:</h2><p>By no means is this an exhaustive wealth of knowledge on static
malware analysis, but I hope it will be a useful introduction. Recently I’ve
been doing some Capture the Flag competitions and I’ve found that this has been
enough to get me started on the subject.</p><p>

Remember the most important
part: keep your network safe. The last thing you need is for the malware to
spread. Sites like VirusTotal will probably have enough information, but if not,
you know how to begin searching for information without running the malware<br/></p>
